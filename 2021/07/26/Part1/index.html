<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>大数据之Hbase Part1 | 花逍遥</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.4.2"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">大数据之Hbase Part1</h1><a id="logo" href="/.">花逍遥</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">大数据之Hbase Part1</h1><div class="post-meta">2021-07-26<span> | </span><span class="category"><a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Contents</div><ol class="toc"><li class="toc-item toc-level-5"><a class="toc-link" href="#Hbase%E7%9A%84%E7%89%B9%E6%80%A7"><span class="toc-number">1.</span> <span class="toc-text">Hbase的特性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Hbase%E7%9A%84%E6%84%9F%E6%80%A7%E8%AE%A4%E8%AF%86"><span class="toc-number">2.</span> <span class="toc-text">Hbase的感性认识</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E6%A8%A1%E5%9E%8B%E5%92%8C%E7%89%A9%E7%90%86%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text">逻辑模型和物理模型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B%E7%9A%84%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5"><span class="toc-number">4.</span> <span class="toc-text">数据模型的重要概念</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">访问方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="toc-number">6.</span> <span class="toc-text">整体架构</span></a></li></ol></div></div><div class="post-content"><h5 id="Hbase的特性"><a href="#Hbase的特性" class="headerlink" title="Hbase的特性"></a>Hbase的特性</h5><blockquote>
<p>  强一致性读写: HBase 不是 “最终一致性(eventually consistent)” 数据存储.<br>    这让它很适合高速计数聚合类任务。<br>    自动分片(Automatic sharding): HBase 表通过region分布在集群中。<br>    数据增长时，region会自动分割并重新分布。<br>    RegionServer 自动故障转移<br>    Hadoop/HDFS 集成: HBase 支持本机外HDFS 作为它的分布式文件系统。<br>    MapReduce: HBase 通过MapReduce支持大并发处理， HBase 可以同时做源和目标.<br>    Java 客户端 API: HBase 支持易于使用的 Java API 进行编程访问.<br>    Thrift/REST API: HBase 也支持Thrift 和 REST 作为非Java 前端.<br>    Block Cache 和 Bloom Filters: 对于大容量查询优化，<br>    HBase支持 Block Cache 和 Bloom Filters。<br>    运维管理: HBase提供内置网页用于运维视角和JMX 度量.</p>
</blockquote>
<h5 id="Hbase的感性认识"><a href="#Hbase的感性认识" class="headerlink" title="Hbase的感性认识"></a>Hbase的感性认识</h5><p>hbase实操练习 可以看官方文档，先操作一遍，增强感性的认识<br>在HBase中，namespace命名空间指对一组表的逻辑分组，类似RDBMS中的database，方便对表在业务上划分。<br>help ‘namespace’ 可以打出来各种帮助命令，方便使用 还有help ‘ddl’,help ‘dml’等命令。<br>Hbase一行数据可以类比RDBMS中的一行，表示一个实体，一个实体的所有信息都可以放到一行中。<br>在hbase中，操作的时候对每一个列操作，所以多次操作的时候，指定同一个rowkey,表示的是同一个对象。<br>需求：创建一个表，并写入一条记录，name:student.evan,age:30,phone:130xxx<br>在Hbase中操作如下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create_namespace <span class="string">&#x27;evan&#x27;</span> <span class="comment">#创建一个自己用的namespace</span></span><br><span class="line">list_namespace  <span class="comment">#列出来查看一下</span></span><br><span class="line">create <span class="string">&#x27;evan:test1&#x27;</span>, <span class="string">&#x27;cf1&#x27;</span> <span class="comment">#在这个namespace下创建一个表，只有一个列族 cf1</span></span><br><span class="line">put    <span class="string">&#x27;evan:test1&#x27;</span>, <span class="string">&#x27;row1&#x27;</span>, <span class="string">&#x27;cf1:name&#x27;</span>, <span class="string">&#x27;student.evan&#x27;</span> <span class="comment">#给表evan:test1插入一条数据，行键row1,列名为name</span></span><br><span class="line">put    <span class="string">&#x27;evan:test1&#x27;</span>, <span class="string">&#x27;row1&#x27;</span>, <span class="string">&#x27;cf1:age&#x27;</span>, <span class="string">&#x27;30&#x27;</span> <span class="comment">#给表evan:test1插入一条数据，行键row1,列名为name,值30</span></span><br><span class="line">put    <span class="string">&#x27;evan:test1&#x27;</span>, <span class="string">&#x27;row1&#x27;</span>, <span class="string">&#x27;cf1:phone&#x27;</span>, <span class="string">&#x27;130xxx&#x27;</span> <span class="comment">#给表evan:test1插入一条数据，行键row1,列名为name,值130xxx</span></span><br><span class="line">scan   <span class="string">&#x27;evan:test1&#x27;</span> <span class="comment">#查看表中的数据</span></span><br></pre></td></tr></table></figure>
<h5 id="逻辑模型和物理模型"><a href="#逻辑模型和物理模型" class="headerlink" title="逻辑模型和物理模型"></a>逻辑模型和物理模型</h5><p><strong>逻辑模型</strong><br>Hbase是google开放的论文BigTable的开源实现，它原定的使命是用来存储网络爬虫抓取的网站数据，用于搜索引擎使用。<br>它表中的每一行可以有不同的列，它不需要指定列，需要提前指定列族。它存储的数据没有数据类型，都是存储成字节数组。<br>行有行键，每一行的行键是唯一的，相同行键的插入操作被认为是同一行的操作。<br>列中的值可以有多个版本，有时间戳来标识不同的版本。<br>可以把Hbase理解为无限嵌套的HashMap。<br><strong>物理模型</strong><br>Hbase的物理存储是按列族存放的，一个列族的数据会被同一个Region管理，物理上放在一起。<br>空白的Cell在物理上是不存储的，返回是空值。</p>
<h5 id="数据模型的重要概念"><a href="#数据模型的重要概念" class="headerlink" title="数据模型的重要概念"></a>数据模型的重要概念</h5><p>Hbase中原生不支持join,它是列存储的，可以把大量的信息存储到一个表，传统的数据库表设计规范不适用于它。<br>Hbase中的表相对比较少，一个表中可以包括原有RDBMS中多个表的数据，通常是大宽表。<br>可以把它理解为kv数据库。<br>Hbase没有列定义，没有字段类型，这就是它被称为无模式数据库的原因。<br><strong>行键(rowkey)</strong><br>行键是不可分割的字节数组，是按字典顺序由低到高存储在表中的。<br>为了高效检索数据，需要仔细设计rowkey以提高查询性能，避免热点分布。<br><strong>列族</strong><br>列族是列的集合，创建表的时候只需要先定义好列族。在写入数据的时候指定列即可。<br>在物理上，一个列族的成员在文件系统上是存储在一起的，存储优化是针对列族级别的。<br>创建表的时候，至少需要指定一个列族，新的列族可以后面动态加入，但需要先disable表。<br>不要创建过多的列族，因为跨列族的访问是非常低效的。因为是不同的物理存储位置。<br><strong>单元格(cell)</strong><br>单元格由rowkey,column family,col,timestamp唯一确定。它的内容是不可分割的字节数组。<br>每一个单元格都保存着同一份数据的不同版本，不同时间版本按照时间顺序倒序排序（最新在最新面）。<br>TTL(time to live),用于设置单元格的生存周期，如果过期，则会被删除。<br>早于指定TTL值的数据会在下一次大合并时被删除。</p>
<h5 id="访问方式"><a href="#访问方式" class="headerlink" title="访问方式"></a>访问方式</h5><ol>
<li>可以使用hbase shell客户端访问。</li>
<li>如果hbase rest网关启动了，就可以使用curl 命令来访问rest api进行CRUD。</li>
<li>使用Java api /python api/ mapreduce来访问。</li>
<li>使用phoenix 写sql来查询hbase<br>Phoenix查询引擎会将sql查询转换成一个或多个hbase scan,并行执行以生成标准的<br>jdbc结果集。它支持DDL,DML,紧跟ANSI sql标准。</li>
<li>Hbase可以整合为hive的表，用hive sql来访问<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> hbase_table_1( key <span class="type">int</span>, <span class="keyword">value</span> string)</span><br><span class="line">STORED <span class="keyword">BY</span> <span class="string">&#x27;org.apache.hadoop.hive.hbase.HBaseStorageHandler&#x27;</span></span><br><span class="line"><span class="keyword">WITH</span> SERDEPROPERTIES (</span><br><span class="line">    &quot;hbase.columns.mapping&quot;<span class="operator">=</span>&quot;cf:c1&quot;,</span><br><span class="line">    &quot;hbase.table.name&quot;<span class="operator">=</span>&quot;hbase_table_1&quot;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h5 id="整体架构"><a href="#整体架构" class="headerlink" title="整体架构"></a>整体架构</h5></li>
</ol>
<p><strong>核心组件</strong><br>客户端和zookeeper，主节点HMaster和Region节点RegionServer。<br>zk负责多HMaster的选举，服务器之间的状态同步。存储Hbase元数据信息，实时监控RegionSever,<br>存储所有Region的寻址入口。<br>HMaster主要负责 Table和Region的管理工作：</p>
<ol>
<li>管理用户对Table的增删改查</li>
<li>管理RegionSever的负载均衡，调整Region分布</li>
<li>Region的重分配和迁移工作<br>RegionServer 主要负责响应客户的IO请求，向文件系统读写数据。</li>
</ol>
<p><strong>目录表(Catalog Tables)</strong><br>目录表 -ROOT- 和 .META. 作为 HBase 表存在。他们被HBase shell的 list 命令过滤掉了，<br>但他们和其他表一样存在。<br> -ROOT- 保存 .META. 表存在哪里的踪迹。<br>.META. 保存系统中所有region列表。在哪个regsion server存放。<br><strong>客户端</strong><br>HBase客户端的 HTable类负责寻找相应的RegionServers来处理行。他是先查询 .META. 和 -ROOT 目录表。<br>然后再确定region的位置。定位到所需要的区域后，客户端会直接去访问相应的region(不经过master)，<br>发起读写请求。这些信息会缓存在客户端，这样就不用每发起一个请求就去查一下。<br><strong>存储文件</strong><br>Hstore是Hbase存储的核心，它由两部分组成，memstore和StoreFile。<br>用户写入的数据会首先放到MemStore当中，满了以后会flush到StoreFile(Hfile),StoreFiles文件数增长到<br>一定的阈值，会触发Compact操作，将多个Storefiles合并成一个StoreFile,在Major Compact中会进行版本<br>合并和数据删除。由此可知，Hbase只增加数据，所有的更新和删除都是在Compact中进行的，这保证了它的高速写。<br>单个StoreFile大小达到一定阈值后，会触发Split操作，同时会把当前Region分裂成两个Region,父Region下线，<br>新分裂的两个子Region会被分配到相应的HRgionServer上。<br><strong>Hlog和数据恢复</strong><br>每一个RegionServer中都有一个Hlog对象，Hlog对象是一个实现了WAL的类，用户的操作在写入memStore的同时，<br>会写入到Hlog文件中，它会定期滚动出新，删除旧的文件。<br>当RegionServer意外中止后，Hmaster会通过zk感知到，首先处理遗留的Hlog文件，将其中不同Region的Log数据<br>进行拆分，分别放到相应的Region目录下，然后再将失效的Region重新分配。<br>领取到这些Region的RegionServer在加载Region的过程中，会发现有历史Hlog需要处理，会将Hlog中的数据回放到<br>MemStore中，然后flush到StoreFile,完成数据恢复。</p>
</div><div class="tags"><a href="/tags/Hbase"><i class="fa fa-tag">Hbase</i></a><a href="/tags/大数据"><i class="fa fa-tag">大数据</i></a></div><div class="post-nav"><a class="pre" href="/2021/09/04/%E7%A7%8B%E6%9E%AB/">秋枫</a><a class="next" href="/2021/07/25/%E7%90%86%E8%A7%A3Java%E4%B8%AD%E7%9A%84%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86Part1/">理解Java中的动态代理Part1</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://example.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Hive/">Hive</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JS/">JS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SQL/">SQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spark/">Spark</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9F%BA%E7%A1%80/">基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB/">生活</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/">面试题</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/JAVA/" style="font-size: 15px;">JAVA</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 15px;">面试题</a> <a href="/tags/Hbase/" style="font-size: 15px;">Hbase</a> <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 15px;">大数据</a> <a href="/tags/Spark/" style="font-size: 15px;">Spark</a> <a href="/tags/Scala/" style="font-size: 15px;">Scala</a> <a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 15px;">博客</a> <a href="/tags/JS/" style="font-size: 15px;">JS</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 15px;">算法</a> <a href="/tags/%E8%AF%AD%E5%BD%95/" style="font-size: 15px;">语录</a> <a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 15px;">生活</a> <a href="/tags/%E6%97%85%E8%A1%8C/" style="font-size: 15px;">旅行</a> <a href="/tags/Hive/" style="font-size: 15px;">Hive</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/04/30/spark-functions/">spark builtin functions</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/04/28/sparksql-puzzle1/">spark-puzzle1 用户最长连续登录天数</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/04/23/hive-metastore-on-minio/">hive metastore on minio</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/04/23/spark-minio/">spark s3 测试</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/04/20/hexo/">Hexo博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/22/%E6%84%9F%E5%86%92123/">感冒123</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/20/%E7%A8%BB%E7%9B%9B%E7%9A%84%E6%B4%BB%E6%B3%95/">稻盛的活法</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/14/%E5%A4%8F%E8%8A%B1%E5%AF%B9%E8%AF%9D%E5%BD%951/">夏花对话录1</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/09/Scala%E5%AD%A6%E4%B9%A0Part3/">Scala学习Part3</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/08/Spark%E9%9D%A2%E8%AF%95%E9%A2%98Part1/">Spark面试题Part1</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="https://www.cnblogs.com/huaxiaoyao/" title="博客园" target="_blank">博客园</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022 <a href="/." rel="nofollow">花逍遥.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>